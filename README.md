## 문제
- 쿠버네티스 인프라 환경 구성 및 구성도 작성
- 필수사항
	- 헬스체크 가능한 CRUD API 서버
	- 디비 자유
	- [[Terraform]]을 통한 인프라 구성
- 우대사항
	- [[Rust]]를 사용한 api 서버 
	- [[Helm]]을 통한 배포
## 제출
- 서버 레포지토리, 환경 구성 레포지토리 링크
## 목표
- 실현 가능성으로는 어차피 망함
	- 교육과 프로젝트도 병행 중이라 시간을 많이 투자할 수 없음
	- 테라폼은 영상으로만 본 정도
	- 쿠버네티스는 기본 개념만 익힌 정도
	- 러스트는 취업 이후로 미룸
- 그럼 그냥 과제 빌미로 하고 싶은 거 다 해보자.
- 여태 시간을 빌미로 시도하지 못했던 것들, 도전만 해보기
### 기술적 목표
- 테라폼을 통한 [[프로비저닝]]
- 기본적인 수준의 쿠버네티스 아키텍처 세우고 실제로 빌드하기
- 클러스터 모니터링
- 헬름 차트?
	- 아직 매니페스트 방식에 완벽히 숙달되지 않았으므로 이번에는 시도하지 않는다.
### 운영적 목표
- 자동화된 프로비저닝
	- [[Infrastructure As a Code]]
	- 기록이 아닌 정의를 통한 환경 관리
- 클러스터 내 고가용성
	- 자가 회복 능력 확보
		- 테스트 진행하면 좋을 듯
	- 오토스케일링 
	- 분산 파드 배치
- 이상 탐지 및 알림 연동
	- [[Grafana]] 활용
	- 위기 감지 및 장애 대응성 확보
- 배포 전략 
	- 카나리 배포
	- 무중단 배포를 통한 서비스 불가용 시간 단축
	- 롤백 기능 도입
- 디비 안전 배치
	- 분산 디비 동기화
	- stateful하고, 백업 보장
- 시크릿 관리

# 설계
## 환경
- 금액을 고려하여 노트북에서 진행
	- 사양 이슈로 하나의 마스터 플레인, 3개의 워커 노드
- [[Vagrant]]로 [[VirtualBox]] 클러스터 환경 구축
- 운영 환경을 고려하여 kubectl은 호스트 환경에서 명령할 수 있도록 세팅
## 아키텍처
![api-server-kube](https://github.com/user-attachments/assets/12e8000f-51b5-48b1-95ab-e15f07f9da15)

- 노드마다 api 서버 분산 배치
	- [[DaemonSet]]을 활용해 최소 하나를 보장하여 가용성 확보
	- [[ConfigMap]]을 통해 배포 환경의 환경변수 통일 관리
- 데이터베이스 -> 구현 실패
	- mysql operator 활용
	- 호스트 환경에 nfs 서버를 배치하고 동적 프로비저닝을 위한 스토리지 클래스로 활용
- 통신  -> 구현 실패
	- nginx ingress controller 활용
	- 외부에서 `api`엔드포인트를 넣어서 보내면 내부 api 서버로 rewrite되도록

자세한 구현 사항은 블로그 참조
